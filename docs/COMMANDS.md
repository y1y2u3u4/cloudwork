# Telegram 命令参考

CloudWork Telegram Bot 完整命令文档。

## 📋 命令速查表

| 命令 | 功能 | 示例 |
|------|------|------|
| `/start` | 显示帮助 | `/start` |
| `/run <提示>` | 独立执行任务 | `/run 写个排序算法` |
| `/new [名称]` | 创建新会话 | `/new Flask项目` |
| `/sessions` | 查看/切换会话 | `/sessions` |
| `/archived` | 查看归档会话 | `/archived` |
| `/delete <ID>` | 删除会话 | `/delete abc123` |
| `/model` | 切换模型 | `/model` |
| `/mode` | 切换执行模式 | `/mode` |
| `/project` | 切换项目 | `/project` |
| `/settings` | 打开设置菜单 | `/settings` |
| `/status` | 查看运行状态 | `/status` |
| `/cancel` | 取消当前任务 | `/cancel` |
| `/target` | 切换执行目标 (VPS/本地) | `/target` |

---

## 🚀 基础命令

### `/start`

显示帮助信息和可用命令列表。

```
/start
```

### `/run <prompt>`

独立执行一个任务，**不影响当前会话上下文**。

```
/run 帮我创建一个 Python Hello World 程序
/run 分析 ./src 目录的代码结构
/run 这个报错是什么意思：[报错信息]
```

**特点:**
- 每次 `/run` 是独立任务，不保留上下文
- 适合一次性查询或独立任务
- 不会创建或影响任何会话

---

## 📂 会话管理

### `/sessions`

查看当前活跃会话列表，点击按钮可切换会话。

```
/sessions
```

**显示内容:**
- 会话名称
- 最后活跃时间
- 消息数量
- 当前活跃会话有 ▶️ 标记

### `/new [名称]`

创建新会话并自动切换到该会话。

```
/new                    # 自动命名
/new 前端开发项目        # 自定义名称
/new API重构            # 自定义名称
```

**特点:**
- 新会话自动成为当前活跃会话
- 如不指定名称，首条消息后 AI 自动命名
- 推荐使用有意义的名称便于管理

### `/archived`

查看已归档的会话，点击可恢复。

```
/archived
```

**归档规则:**
- 30 分钟无活动自动归档
- 点击可恢复为活跃会话
- 恢复后可继续之前的对话

### `/delete <会话ID>`

删除指定会话（**不可恢复**）。

```
/delete abc123
```

**注意:** 删除前请确认，此操作不可撤销。

---

## ⚙️ 设置命令

### `/settings`

打开统一设置菜单，可以一站式管理所有设置。

```
/settings
```

菜单包含：
- 模型选择
- 执行模式
- 项目切换

### `/model`

切换 Claude 模型。

```
/model
```

**可选模型:**

| 模型 | 说明 | 适用场景 |
|------|------|----------|
| `sonnet` | Claude Sonnet（默认）| 日常开发任务 |
| `opus` | Claude Opus（最强）| 复杂架构设计、疑难问题 |
| `haiku` | Claude Haiku（最快）| 简单查询、格式化 |

### `/mode`

切换执行模式。

```
/mode
```

**可选模式:**

| 模式 | 说明 | 适用场景 |
|------|------|----------|
| `auto` | 自动执行（默认）| 快速开发，跳过确认 |
| `plan` | 计划模式 | 大型重构，先看计划再执行 |

### `/project`

查看和切换工作空间项目。

```
/project
```

**项目发现规则:**
- 扫描 `workspace/` 目录
- 识别包含 `CLAUDE.md` 的子目录
- 切换项目后，Claude 在该项目上下文中工作

---

## 💬 对话方式

### 直接发送消息

在当前活跃会话中继续对话。

```
用户: 帮我写一个排序函数
Claude: [回复...]

用户: 改成快速排序
Claude: [回复，保持上下文...]
```

### 回复历史消息

自动切换到该消息所属的会话，然后继续对话。

```
[回复某条历史消息]
用户: 继续上次的工作

Bot: 🔄 已切换到该会话
Claude: [在原会话上下文中回复...]
```

**特点:**
- 自动切换会话上下文
- 恢复该会话的完整历史
- 无需手动使用 `/sessions` 切换

---

## 🔘 交互式问答

当 Claude 需要用户确认时，会显示选择按钮：

```
Claude: 检测到多个文件，请选择要修改的文件：
[文件A] [文件B] [文件C] [取消]
```

点击按钮即可响应。

**交互类型:**
- 文件选择
- 操作确认
- 方案选择
- 自定义输入（点击后直接发消息）

---

## 📊 状态和控制

### `/status`

查看当前运行状态。

```
/status
```

显示：
- 运行时间
- 活跃任务数
- 当前会话信息
- 当前模型和模式

### `/cancel`

取消当前正在执行的任务。

```
/cancel
```

也可以直接发送 `取消` 文字。

### `/target`

切换执行目标（VPS 或本地节点）。

```
/target                              # 查看当前状态
/target vps                          # 切回 VPS 执行
/target local http://ip:port         # 切换到本地节点
/target token your_api_token         # 设置本地节点 Token
```

**使用场景:**
- 需要在本地 Mac 上执行任务（访问本地文件、MCP 服务等）
- 通过 Tailscale 内网穿透连接

📖 详细配置：[local-node-execution.md](local-node-execution.md)

---

## 🖼️ 图片分析

直接发送图片给 Bot，Claude 会分析图片内容。

**支持的场景:**
- 截图分析代码错误
- UI 设计稿分析
- 图表数据解读
- 任何需要视觉理解的任务

```
[发送图片]
用户: 这个报错是什么意思？
Claude: 根据截图，错误是...
```

---

## 📝 使用示例

### 示例 1：开始新项目

```
/new 电商后端开发
→ 创建专用会话

帮我设计用户认证模块的数据库结构
→ Claude 在该会话中工作

实现登录接口
→ 继续在同一会话，保持上下文
```

### 示例 2：快速查询

```
/run Python 中如何读取 JSON 文件
→ 独立查询，不影响当前会话

/run 这个报错什么意思：TypeError...
→ 独立查询
```

### 示例 3：切换项目

```
/project
→ 显示项目列表

[点击 frontend-app]
→ 切换到该项目

帮我修复登录页面的 bug
→ Claude 在 frontend-app 项目上下文中工作
```

### 示例 4：调试复杂问题

```
/model
→ 选择 opus（更强大）

帮我分析这个内存泄漏问题
→ 使用 Opus 模型处理复杂问题
```

### 示例 5：大型重构

```
/mode
→ 选择 plan（计划模式）

重构整个认证模块
→ Claude 先展示计划，等待确认后执行
```

---

## 💡 快捷技巧

| 操作 | 方式 |
|------|------|
| 快速取消任务 | 发送 `取消` 或 `/cancel` |
| 切回之前的会话 | 回复那个会话的历史消息 |
| 临时使用强模型 | `/model` 切换到 opus，完成后切回 sonnet |
| 不想影响当前会话 | 使用 `/run` 执行独立任务 |

---

## ⚠️ 注意事项

1. **会话自动归档**: 30 分钟无活动的会话会自动归档
2. **删除不可恢复**: `/delete` 删除会话后无法恢复
3. **白名单限制**: 只有在 `TELEGRAM_ALLOWED_USERS` 中的用户才能使用
4. **超时设置**: 默认命令执行超时 300 秒，可在配置中调整
